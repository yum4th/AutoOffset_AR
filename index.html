<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcaea OFFSET判定分析ツール</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; padding: 20px; max-width: 600px; margin: 0 auto; }
        h1 { font-size: 20px; color: #333; }
        .input-group { margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between; }
        .input-group label { width: 120px; font-weight: bold; }
        /* マイナスを入力しにくくし、見た目を整える */
        input { padding: 8px; width: 100px; font-size: 16px; text-align: right; }
        button { width: 100%; padding: 15px; font-size: 18px; background-color: #0366d6; color: white; border: none; border-radius: 5px; margin-top: 20px; cursor: pointer; }
        button:hover { background-color: #0255b3; }
        .result-box { margin-top: 20px; padding: 15px; background-color: #f6f8fa; border: 1px solid #d1d5da; border-radius: 5px; }
        .result-item { margin: 10px 0; font-size: 18px; }
        .result-value { font-weight: bold; color: #d73a49; }
    </style>
</head>
<body>

    <h1>OFFSET / 判定分析</h1>
    <p>各判定の個数を入力してください（0以上の整数）</p>

    <div class="input-group">
        <label>Pure+ (P)</label>
        <input type="number" id="P" value="0" min="0" step="1">
    </div>
    <div class="input-group">
        <label>FarLate (FL)</label>
        <input type="number" id="FL" value="0" min="0" step="1">
    </div>
    <div class="input-group">
        <label>PureLate (PL)</label>
        <input type="number" id="PL" value="0" min="0" step="1">
    </div>
    <div class="input-group">
        <label>FarEarly (FE)</label>
        <input type="number" id="FE" value="0" min="0" step="1">
    </div>
    <div class="input-group">
        <label>PureEarly (PE)</label>
        <input type="number" id="PE" value="0" min="0" step="1">
    </div>

    <button onclick="calc()">実行</button>

    <div class="result-box">
        <div class="result-item">LOSTを除いた総ノーツ数 (n): <span id="res-n" class="result-value">-</span></div>
        <div class="result-item">推定された差 (μ): <br><span id="res-mu" class="result-value">-</span> ms</div>
        <div class="result-item">差の95%信頼区間: <br><span id="res-ci" class="result-value">-</span></div>
    </div>

    <p>現在、設定しているオフセットに推定された差を加えた値をオフセットに設定して下さい</p>
    <p>例えば, 現在のオフセット: 56ms, 推定された差: -3.132msの場合</p>
    <p>56ms + (-3.132) = 52.868 -> 設定するオフセット: 52ms</p>
    
    <script>
        function calc() {
            // 1. 入力を取得
            const P = Number(document.getElementById('P').value);
            const FL = Number(document.getElementById('FL').value);
            const PL = Number(document.getElementById('PL').value);
            const FE = Number(document.getElementById('FE').value);
            const PE = Number(document.getElementById('PE').value);

            // 2. エラーチェック：マイナスの値がないか確認
            if (P < 0 || FL < 0 || PL < 0 || FE < 0 || PE < 0) {
                alert("エラー：ノーツ数はマイナスになりません。0以上の正しい値を入力してください。");
                return;
            }

            // 3. 総数 n を計算
            const n = P + FL + PL + FE + PE;

            // エラーチェック：データ不足
            if (n <= 1) {
                alert("データの総数が少なすぎます (2個以上必要です)");
                return;
            }

            // 4. 平均 (mu) の計算
            const mu = (75.0 * (FL - FE) + 37.5 * (PL - PE)) / n;

            // 5. 分散 (sig2) の計算
            const termFE = FE * Math.pow(-75.0 - mu, 2);
            const termPE = PE * Math.pow(-37.5 - mu, 2);
            const termP  = P  * Math.pow(0.0 - mu, 2);
            const termPL = PL * Math.pow(37.5 - mu, 2);
            const termFL = FL * Math.pow(75.0 - mu, 2);

            const sig2 = (termFE + termPE + termP + termPL + termFL) / (n - 1);

            // 6. 信頼区間の計算
            const margin = 1.96 * Math.sqrt(sig2 / n);
            const lower = mu - margin;
            const upper = mu + margin;

            // 7. 結果を表示
            document.getElementById('res-n').innerText = n;
            document.getElementById('res-mu').innerText = mu.toFixed(4);
            document.getElementById('res-ci').innerText = `[${lower.toFixed(4)}, ${upper.toFixed(4)}]`;
        }
    </script>

</body>
</html>

