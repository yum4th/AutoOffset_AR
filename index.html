<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcaea OFFSETåˆ¤å®šåˆ†æãƒ„ãƒ¼ãƒ«</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; padding: 20px; max-width: 600px; margin: 0 auto; }
        h1 { font-size: 20px; color: #333; }
        .input-group { margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between; }
        .input-group label { width: 120px; font-weight: bold; }
        input { padding: 8px; width: 100px; font-size: 16px; text-align: right; }
        button { width: 100%; padding: 15px; font-size: 18px; background-color: #0366d6; color: white; border: none; border-radius: 5px; margin-top: 20px; cursor: pointer; }
        button:hover { background-color: #0255b3; }
        .result-box { margin-top: 20px; padding: 15px; background-color: #f6f8fa; border: 1px solid #d1d5da; border-radius: 5px; }
        .result-item { margin: 10px 0; font-size: 18px; }
        .result-value { font-weight: bold; color: #d73a49; }
    </style>
</head>
<body>

    <h1>ğŸ“Š OFFSET / åˆ¤å®šåˆ†æ</h1>
    <p>å„åˆ¤å®šã®å€‹æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>

    <div class="input-group">
        <label>Pure+ (P)</label>
        <input type="number" id="P" value="0">
    </div>
    <div class="input-group">
        <label>FarLate (FL)</label>
        <input type="number" id="FL" value="0">
    </div>
    <div class="input-group">
        <label>PureLate (PL)</label>
        <input type="number" id="PL" value="0">
    </div>
    <div class="input-group">
        <label>FarEarly (FE)</label>
        <input type="number" id="FE" value="0">
    </div>
    <div class="input-group">
        <label>PureEarly (PE)</label>
        <input type="number" id="PE" value="0">
    </div>

    <button onclick="calc()">åˆ†æå®Ÿè¡Œ</button>

    <div class="result-box">
        <div class="result-item">ç·æ•° (n): <span id="res-n" class="result-value">-</span></div>
        <div class="result-item">æ¨å®šOFFSET (Î¼): <br><span id="res-mu" class="result-value">-</span> ms</div>
        <div class="result-item">95%ä¿¡é ¼åŒºé–“: <br><span id="res-ci" class="result-value">-</span></div>
    </div>

    <script>
        function calc() {
            // 1. å…¥åŠ›ã‚’å–å¾—
            const P = Number(document.getElementById('P').value);
            const FL = Number(document.getElementById('FL').value);
            const PL = Number(document.getElementById('PL').value);
            const FE = Number(document.getElementById('FE').value);
            const PE = Number(document.getElementById('PE').value);

            // 2. ç·æ•° n ã‚’è¨ˆç®—
            const n = P + FL + PL + FE + PE;

            // ã‚¨ãƒ©ãƒ¼å‡¦ç†: ãƒ‡ãƒ¼ã‚¿ãŒå°‘ãªã™ãã‚‹ã¨è¨ˆç®—ã§ããªã„ãŸã‚
            if (n <= 1) {
                alert("ãƒ‡ãƒ¼ã‚¿ã®ç·æ•°ãŒå°‘ãªã™ãã¾ã™ (2å€‹ä»¥ä¸Šå¿…è¦ã§ã™)");
                return;
            }

            // 3. å¹³å‡ (mu) ã®è¨ˆç®—
            // Java: double mu = (75.0*(FL-FE)+37.5*(PL-PE))/n;
            const mu = (75.0 * (FL - FE) + 37.5 * (PL - PE)) / n;

            // 4. åˆ†æ•£ (sig2) ã®è¨ˆç®—
            // Javaã®é•·ã„è¨ˆç®—å¼ã‚’ãã®ã¾ã¾ç§»æ¤
            // FE*(-75-mu)^2 + PE*(-37.5-mu)^2 ...
            const termFE = FE * Math.pow(-75.0 - mu, 2);
            const termPE = PE * Math.pow(-37.5 - mu, 2);
            const termP  = P  * Math.pow(0.0 - mu, 2);
            const termPL = PL * Math.pow(37.5 - mu, 2);
            const termFL = FL * Math.pow(75.0 - mu, 2);

            const sig2 = (termFE + termPE + termP + termPL + termFL) / (n - 1);

            // 5. ä¿¡é ¼åŒºé–“ã®è¨ˆç®—
            // Java: 1.96 * Math.sqrt(sig2/n)
            const margin = 1.96 * Math.sqrt(sig2 / n);
            const lower = mu - margin;
            const upper = mu + margin;

            // 6. çµæœã‚’è¡¨ç¤º (å°æ•°ç‚¹ç¬¬4ä½ã¾ã§è¡¨ç¤ºã™ã‚‹ãªã©èª¿æ•´)
            document.getElementById('res-n').innerText = n;
            document.getElementById('res-mu').innerText = mu.toFixed(4); // å°æ•°ç‚¹4æ¡
            document.getElementById('res-ci').innerText = `[${lower.toFixed(4)}, ${upper.toFixed(4)}]`;
        }
    </script>

</body>
</html>
